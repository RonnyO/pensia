<!doctype html>
<html lang="he" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>כמה דופקים אותי בפנסיה?</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link href="https://fonts.googleapis.com/icon?family=Rubik" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>
        body {
            font-size: 14px;
        }
        body, .card {
            background-color: #fff9f4;
        }

        body {
            font-family: Rubik, sans-serif !important
        }

        @media (min-width: 768px) {
            html {
                font-size: 16px;
            }
        }

        .container {
            max-width: 960px;
        }

        .pricing-header {
            max-width: 700px;
        }

        .card-deck .card {
            min-width: 220px;
        }

        .border-top {
            border-top: 1px solid #e5e5e5;
        }

        .border-bottom {
            border-bottom: 1px solid #e5e5e5;
        }

        .btn-xl {
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 7px;
        }

        #calculations {
            display: none;
        }

        .display-4-5 {
            font-size: 3rem;
            font-weight: 300;
            line-height: 1.2;
        }

        #calculations div {
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
        <h1 class="display-3">כמה דופקים אותי בפנסיה?</h1>
        <p class="lead"></p>
    </div>

    <div class="container">
        <form id="form">
            <div class="card-deck mb-3 text-center">
                <div class="card mb-4 border-0">
                    <div class="card-body">
                        <h3 class="card-title pricing-card-title">אני בן</h3>
                        <input type="number" name="current_age" class="form-control" required></input>
                    </div>
                </div>
                <div class="card mb-4 border-0">
                    <div class="card-body">
                        <h3 class="card-title pricing-card-title">אני מרוויח</h3>
                        <input type="number" name="salary" class="form-control" required></input>
                    </div>
                </div>
                <div class="card mb-4 border-0">
                    <div class="card-body">
                        <h3 class="card-title pricing-card-title">התחלתי לעבוד בגיל</h3>
                        <input type="number" name="start_of_work_age" class="form-control" required></input>
                    </div>
                </div>

                <button type="button" class="btn btn-xl btn-block btn-primary" onclick="onSubmit()">כמה דופקים
                    אותי?</button>
            </div>
        </form>
    </div>

    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center" id="calculations">
        <h2 class="display-4-5">מרבית האנשים משלמים בשנה</h2>
        <h2>1. <span id="fees">2000</span> שקל מיותרים על דמי ניהול</h2>
        <h2>2. <span id="insurance">5000</span> שקל מיותרים על ביטוחים</h2>
        <h2 class="display-4"><span id="bottomline">סה״כ דופקים אותך ב<span id="total">7000</span> שקל כל שנה</span>
        </h2>
    </div>


    <script src="rough-notation.iife.js"></script>

    <script>
        const a1 = RoughNotation.annotate(document.querySelector('#fees'), { type: 'underline', color: 'red', iterations: 2, rtl: true });
        const a2 = RoughNotation.annotate(document.querySelector('#insurance'), { type: 'underline', color: 'red', iterations: 2, rtl: true });
        const a3 = RoughNotation.annotate(document.querySelector('#bottomline'), { type: 'highlight', color: 'yellow', iterations: 1, multiline: true, rtl: true });

        const ag = RoughNotation.annotationGroup([a1, a2, a3]);

        function onSubmit() {
            console.log(1);

            let form = document.getElementById('form');
            let calc = document.getElementById('calculations');

            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();

                form.classList.add('was-validated');

                // return;
            }
            form.classList.remove('was-validated');

            calc.style.display = 'block';
            calc.scrollIntoView(true);
            ag.show();
        }

        const age = 30;
        const salary = 28;
        const startedWorkingAge = 26;

        const yearsWorking = age - startedWorkingAge;

        function getYearlyPensionDeposit(salary) {
            const employerCompensationDep = 8.33/100;
            const employerPensionDep = 6.5/100;
            const employeePensionDep = 6/100;
            const pensionDepositPercent = employerCompensationDep + employerPensionDep + employeePensionDep
            const yearlyPensionDeposit = salary * pensionDepositPercent * 12;
            return yearlyPensionDeposit
        }

        const currentDepositFee = 2.15/100;
        const currentAccFee = 0.5/100;

        function calculatePension(salary, yearsNum, yield, depositFee, accFee, initialAmount) {
            let pensionSize = initialAmount || 0;
            let depositFeePaid = 0;
            let accFeePaid = 0;
            
            const yearlyPensionDeposit = getYearlyPensionDeposit(salary)
            const depositAfterFee = yearlyPensionDeposit * (1 - depositFee)
            for (let i = 0; i < yearsNum; i++) {
                const withNewDeposit = pensionSize + depositAfterFee;
                const withYields = withNewDeposit * (1 + yield);
                const afterAccFee = withNewDeposit * (1 + yield - accFee);

                depositFeePaid += yearlyPensionDeposit - depositAfterFee;
                accFeePaid += withYields - afterAccFee;
                pensionSize = afterAccFee;
            }
            return {
                pensionSize,
                depositFeePaid,
                accFeePaid
            }
        }
    </script>


</body>
</body>

</html>