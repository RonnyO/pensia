<!doctype html>
<html lang="he" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>כמה דופקים אותי בפנסיה?</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link rel="stylesheet" href="https://hamidheidarinia.github.io/bootstrap-rtl/4.2/assets/css/custom-rtl.min.css">

    <link href="https://fonts.googleapis.com/icon?family=Rubik" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>
        body {
            font-size: 14px;
        }

        body,
        .card {
            background-color: #fff9f4;
        }

        body {
            font-family: Rubik, sans-serif !important
        }

        @media (min-width: 768px) {
            html {
                font-size: 16px;
            }
        }

        .container {
            max-width: 960px;
        }

        .pricing-header {
            max-width: 700px;
        }

        .card-deck .card {
            min-width: 220px;
        }

        .border-top {
            border-top: 1px solid #e5e5e5;
        }

        .border-bottom {
            border-bottom: 1px solid #e5e5e5;
        }

        .btn-xl {
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 7px;
        }

        #calculations {
            display: none;
        }

        .display-4-5 {
            font-size: 3rem;
            font-weight: 300;
            line-height: 1.2;
        }

        #calculations div {
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
        <h1 class="display-3">כמה דופקים אותי בפנסיה?</h1>
    </div>

    <div class="container">
        <form id="form" onsubmit="console.log(1)">
            <div class="card-deck mb-3 text-center">
                <div class="card mb-4 border-0">
                    <div class="card-body">
                        <h3 class="card-title pricing-card-title">אני בן</h3>
                        <input type="number" name="current_age" class="form-control" autofocus required></input>
                    </div>
                </div>
                <div class="card mb-4 border-0">
                    <div class="card-body">
                        <h3 class="card-title pricing-card-title">התחלתי לעבוד בגיל</h3>
                        <input type="number" name="start_of_work_age" class="form-control" required></input>
                    </div>
                </div>
                <div class="card mb-4 border-0">
                    <div class="card-body">
                        <h3 class="card-title pricing-card-title">אני מרוויח</h3>
                        <input type="number" name="salary" class="form-control" required></input>
                    </div>
                </div>

                <button type="button" id="submit" class="btn btn-xl btn-block btn-primary" onclick="onSubmit()">כמה דופקים
                    אותי?</button>
            </div>
        </form>
    </div>

    <div class="px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center" id="calculations">
        <h2 class="display-4-5">עד היום דפקו אותך על סך <span id="pastLoss"></span> שקל</h2>
        <h2>אם תעבור לקרן ברירת מחדל בפנסיה</h2>
        <h2 class="display-4"><span id="future">תוכל לחסוך עוד <span id="futureGains"></span> שקל עד גיל פרישה</span>
        </h2>

        <p class="lead">
            <a href="" data-toggle="modal" data-target="#modal" target="_blank">איך חישבנו את זה?</a>
        </p>

        <p class="lead">
            רוצה ללמוד איך לעשות סדר בפנסיה?<br>
            <a href="https://www.facebook.com/Finaninja/posts/262057594504625" target="_blank">לחץ כאן למדריך הפנסיה</a>
        </p>
    </div>

    <!-- Modal -->
    <div class="modal fade show" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">איך חישבנו את זה?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>
                        המספרים שהצגנו כאן הם הערכה גסה - אבל הם לא מספרים באויר
                    </p>
                    <p>
                        כדי שנוכל לספק את ההערכה הזאת נקטנו בכמה הנחות יסוד:
                        <ol>
                            <li>
                                לשם הפשטות, הנחנו שהמשכורת שלך לא משתנה (בשביל רוב האנשים המשכורת עולה עם השנים אבל העדפנו להחמיר).
                            </li>
                            <li>
                                הנחנו שהפנסיה שלך ממוצעת - לא טובה ולא רעה.
                            </li>
                            <li>
                                לפי המחקר שלנו בפנסיה ממוצעת משלמים דמי ניהול של 0.5% מהצבירה ו-2.15% מהפקדה.
                            </li>
                            <li>
                                השווינו את החיסכון הצפוי לך במסלול הממוצע לחיסכון הצפוי לך במסלול של קרנות הפנסיה ברירת מחדל.
                            </li>
                            <li>
                                השווינו את החיסכון הצפוי לך במסלול הממוצע לחיסכון הצפוי לך במסלול של קרנות הפנסיה ברירת מחדל.
                            </li>
                            <li>
                                קרנות פנסיה ברירת מחדל אלו קרנות נבחרות וזולות שהומלצו על ידי משרד האוצר ורשות שוק ההון.
                            </li>
                            <li>
                                רוב קרנות ברירת המחדל גובות דמי ניהול של 0.1% מהצבירה ו-1.49% מהפקדה, אז אלו המספרים שהכנסנו לחישוב.
                            </li>
                            <li>
                                הנחנו שהחיסכון שלך יצמח בתשואה ממוצעת של 4% לשנה.
                            </li>
                        </ol>
                    </p>
                    <p>
                        מסתבר שלמרות שההפרש בדמי הניהול נשמע קטן, לאורך השנים ההפרש מצטבר לסכום משמעותי בזכות אפקט הריבית דריבית.
                    </p>
                    <p>
                        רוצים לשחק עם המספרים בעצמכם? הכנו לכם אקסל עם כל החישובים
                    </p>
                    <p>
                        הפרויקט שלנו הוא קוד פתוח ללא מטרת רווח, במטרה להנגיש מידע לציבור
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">הבנתי, תודה!</button>
                </div>
            </div>
        </div>
    </div>



    <script src="rough-notation.iife.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script>
        var inputs = document.getElementsByTagName("input");
        for (input of inputs)
            input.addEventListener("keyup", function (event) {
                // Number 13 is the "Enter" key on the keyboard
                if (event.keyCode === 13) {
                    event.preventDefault();
                    // Trigger the button element with a click
                    document.getElementById("submit").click();
                }
            });

        const a1 = RoughNotation.annotate(document.querySelector('#pastLoss'), { type: 'circle', color: 'red', padding: 10, animationDuration: 1500});
        const a2 = RoughNotation.annotate(document.querySelector('#future'), { type: 'highlight', color: 'yellow', iterations: 1, multiline: true, rtl: true, animationDuration: 1500});

        const ag = RoughNotation.annotationGroup([a1, a2]);

        function onSubmit() {
            let form = document.getElementById('form');
            let calc = document.getElementById('calculations');

            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();

                form.classList.add('was-validated');

                return;
            }
            form.classList.remove('was-validated');

            const age = parseInt(form.current_age.value);
            const salary = parseInt(form.salary.value);
            const startedWorkingAge = parseInt(form.start_of_work_age.value);

            let frayer = calculateFrayer(age, salary, startedWorkingAge)

            document.getElementById('pastLoss').innerText = numberWithCommas(frayer.pastLoss);
            document.getElementById('futureGains').innerText = numberWithCommas(frayer.futureGains);

            calc.style.display = 'block';
            calc.scrollIntoView(true);
            ag.show();
        }

        function numberWithCommas(x) {
            return parseInt(x).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function calculateFrayer(age, salary, startedWorkingAge) {
            const averageDepositFee = 2.15 / 100;
            const averageAccFee = 0.5 / 100;

            const goodDepositFee = 1.49 / 100;
            const goodAccFee = 0.1 / 100;

            const retirementAge = 65
            const normalYield = 4 / 100;

            const yearsWorked = age - startedWorkingAge;
            const yearsLeft = retirementAge - age

            const badPastPension = calculatePension(salary, yearsWorked, normalYield, averageDepositFee, averageAccFee, 0);
            const goodPastPension = calculatePension(salary, yearsWorked, normalYield, goodDepositFee, goodAccFee, 0);

            const currentPensionSize = badPastPension.pensionSize;
            const pastLoss = goodPastPension.pensionSize - currentPensionSize;

            const badFuturePension = calculatePension(salary, yearsLeft, normalYield, averageDepositFee, averageAccFee, currentPensionSize)
            const goodFuturePension = calculatePension(salary, yearsLeft, normalYield, goodDepositFee, goodAccFee, currentPensionSize)

            const futureGains = goodFuturePension.pensionSize - badFuturePension.pensionSize;

            return {
                pastLoss,
                futureGains
            }
        }

        function getYearlyPensionDeposit(salary) {
            const employerCompensationDep = 8.33 / 100;
            const employerPensionDep = 6.5 / 100;
            const employeePensionDep = 6 / 100;
            const pensionDepositPercent = employerCompensationDep + employerPensionDep + employeePensionDep
            const yearlyPensionDeposit = salary * pensionDepositPercent * 12;
            return yearlyPensionDeposit
        }

        function calculatePension(salary, yearsNum, yield, depositFee, accFee, initialAmount) {
            let pensionSize = initialAmount || 0;
            let depositFeePaid = 0;
            let accFeePaid = 0;

            const yearlyPensionDeposit = getYearlyPensionDeposit(salary)
            const depositAfterFee = yearlyPensionDeposit * (1 - depositFee)
            for (let i = 0; i < yearsNum; i++) {
                const withNewDeposit = pensionSize + depositAfterFee;
                const withYields = withNewDeposit * (1 + yield);
                const afterAccFee = withNewDeposit * (1 + yield - accFee);

                depositFeePaid += yearlyPensionDeposit - depositAfterFee;
                accFeePaid += withYields - afterAccFee;
                pensionSize = afterAccFee;
            }
            return {
                pensionSize,
                depositFeePaid,
                accFeePaid
            }
        }
    </script>


</body>
</body>

</html>